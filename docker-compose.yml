version: "3.7"

volumes:
  mongodb_volume:
  redis_volume:

services:

  notification:
    build: ./app
    container_name: notification-service
    restart: always
    ports:
      - "8000:80"
    environment:
      - TZ=Europe/Moscow
      - BOT_TOKEN=
      - BOT_ENV=PROD
      - MONGO_NAME=invest
      - MONGO_COLLECTION=notifications
      - MONGO_HOST=mongodb
      - MONGO_PORT=27017
      - CHAT_ID=
      - REDIS_PORT=6379
      - REDIS_HOST=redis
      - REDIS_NOTIFICATION_QUEUE=notification:stock:price:received
      - TIME_OUT=3
    depends_on:
      - mongodb

  bot:
    build: ./bot
    container_name: notification-bot
    restart: always
    environment:
      - TZ=Europe/Moscow
      - TELEGRAM_API_TOKEN=
      - BOT_ENV=PROD
      - TELEGRAM_ACCESS_ID=
      - NOTIFICATION_SERVICE_HOST=notification-service
      - REDIS_NOTIFICATION_QUEUE=notification:stock:price:received
      - NOTIFICATION_SERVICE_PORT=80
      - REDIS_PORT=6379
      - REDIS_HOST=redis
      - TIME_OUT=3
    depends_on:
      - notification

  mongodb:
    image: mongo:latest
    volumes:
     - mongodb_volume:/data/db
    restart: always

  redis:
    image: "redis:alpine"
    volumes:
      - redis_volume:/data
    restart: always